<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ARACEA â€“ LoterÃ­a Solidaria</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
header{background:#ff7a00;padding:12px;text-align:center;font-weight:bold}
.container{padding:15px}
button{width:100%;padding:12px;margin:6px 0;border:none;border-radius:8px;background:#ff7a00;color:#000;font-weight:bold}
.card{background:#1c1c1c;padding:10px;border-radius:8px;margin-bottom:8px}
input,select,textarea{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:none}
.hidden{display:none}
.total{background:#222;padding:10px;border-radius:8px;margin-top:10px}
.logo{max-width:180px;margin:10px auto;display:block}
</style>
</head>
<body>

<header>ARACEA â€“ LoterÃ­a Solidaria</header>

<div class="container">

<!-- INICIO -->
<div id="homeView">
<img src="logo-aracea.png" class="logo">
<h3>CampaÃ±as activas</h3>
<button onclick="openCampaign('Navidad')">ğŸ„ Navidad</button>
<button onclick="openCampaign('NiÃ±o')">ğŸ‘¶ NiÃ±o</button>
<button onclick="openCampaign('Semanal')">ğŸ“… Semanal</button>
<button onclick="openCampaign('Mensual')">ğŸ“† Mensual</button>
<button onclick="showGlobalHistory()">ğŸ“Š Historial Global</button>
<button onclick="showBackup()">ğŸ’¾ Copia de seguridad</button>
</div>

<!-- AÃ‘OS -->
<div id="yearView" class="hidden">
<h3 id="campTitle"></h3>
<select id="yearSelect"></select>
<button onclick="enterYear()">Entrar campaÃ±a</button>
<button onclick="backHome()">â¬… Volver</button>
</div>

<!-- CAMPAÃ‘A -->
<div id="campaignView" class="hidden">
<h3 id="campaignTitle"></h3>

<h4>âš™ ConfiguraciÃ³n</h4>
<input type="number" id="beneficio" placeholder="Beneficio ARACEA por dÃ©cimo (â‚¬)">
<button onclick="saveSettings()">Guardar configuraciÃ³n</button>

<h4>ğŸ¦ Casa de LoterÃ­a</h4>
<input type="number" id="casaDecimos" placeholder="DÃ©cimos recogidos de la casa">
<input type="number" id="casaDinero" placeholder="Dinero entregado a la casa (â‚¬)">
<button onclick="addCasa()">Registrar movimiento casa</button>

<h4>ğŸ§ Venta</h4>
<input id="nombre" placeholder="Nombre comprador">
<input type="number" id="cantidad" placeholder="Cantidad de dÃ©cimos">
<input type="number" id="precio" placeholder="Precio por dÃ©cimo (â‚¬)">
<select id="pago">
<option>Efectivo</option>
<option>Bizum</option>
<option>Transferencia</option>
<option>Otro</option>
</select>
<textarea id="obs" placeholder="Observaciones"></textarea>
<button onclick="addVenta()">Guardar venta</button>

<h4>ğŸ“œ Historial ventas</h4>
<div id="ventasList"></div>

<div class="total" id="resumen"></div>

<button onclick="closeCampaign()">ğŸ”’ Cerrar campaÃ±a</button>
<button onclick="backYears()">â¬… Cambiar aÃ±o</button>
</div>

<!-- HISTORIAL GLOBAL -->
<div id="historyView" class="hidden">
<h3>Historial Global</h3>
<div id="historyList"></div>
<button onclick="backHome()">â¬… Volver</button>
</div>

<!-- BACKUP -->
<div id="backupView" class="hidden">
<h3>Copia de seguridad</h3>
<button onclick="exportBackup()">Exportar copia</button>
<input type="file" id="importFile">
<button onclick="importBackup()">Restaurar copia</button>
<button onclick="backHome()">â¬… Volver</button>
</div>

</div>

<script>
let data=JSON.parse(localStorage.getItem("araceaApp"))||{campaigns:{}};
let currentCamp="",currentYear="";

function save(){localStorage.setItem("araceaApp",JSON.stringify(data));}

function openCampaign(c){
 currentCamp=c;
 document.getElementById("homeView").classList.add("hidden");
 document.getElementById("yearView").classList.remove("hidden");
 document.getElementById("campTitle").innerText="CampaÃ±a "+c;
 loadYears();
}

function loadYears(){
 let sel=document.getElementById("yearSelect");
 sel.innerHTML="";
 let y=new Date().getFullYear();
 for(let i=y-1;i<=y+3;i++){
  let o=document.createElement("option");
  o.value=i;o.text=i;
  sel.appendChild(o);
 }
}

function enterYear(){
 currentYear=document.getElementById("yearSelect").value;
 if(!data.campaigns[currentCamp])data.campaigns[currentCamp]={};
 if(!data.campaigns[currentCamp][currentYear]){
  data.campaigns[currentCamp][currentYear]={ventas:[],casa:[],beneficio:3,closed:false};
 }
 showCampaign();
}

function showCampaign(){
 document.getElementById("yearView").classList.add("hidden");
 document.getElementById("campaignView").classList.remove("hidden");
 document.getElementById("campaignTitle").innerText=currentCamp+" "+currentYear;
 document.getElementById("beneficio").value=data.campaigns[currentCamp][currentYear].beneficio;
 renderVentas();
}

function saveSettings(){
 data.campaigns[currentCamp][currentYear].beneficio=parseFloat(document.getElementById("beneficio").value||3);
 save();alert("ConfiguraciÃ³n guardada");
}

function addCasa(){
 let d=parseInt(document.getElementById("casaDecimos").value||0);
 let e=parseFloat(document.getElementById("casaDinero").value||0);
 data.campaigns[currentCamp][currentYear].casa.push({d,e});
 save();alert("Movimiento guardado");
 document.getElementById("casaDecimos").value="";
 document.getElementById("casaDinero").value="";
}

function addVenta(){
 let n=document.getElementById("nombre").value;
 let c=parseInt(document.getElementById("cantidad").value);
 let p=parseFloat(document.getElementById("precio").value);
 let f=document.getElementById("pago").value;
 let o=document.getElementById("obs").value;
 if(!n||!c||!p)return alert("Faltan datos");
 data.campaigns[currentCamp][currentYear].ventas.push({n,c,p,f,o});
 save();
 document.getElementById("nombre").value="";
 document.getElementById("cantidad").value="";
 document.getElementById("precio").value="";
 document.getElementById("obs").value="";
 renderVentas();
}

function renderVentas(){
 let list=document.getElementById("ventasList");
 let res=document.getElementById("resumen");
 list.innerHTML="";
 let total=0,dec=0,benef=0;
 let b=data.campaigns[currentCamp][currentYear].beneficio;
 data.campaigns[currentCamp][currentYear].ventas.forEach((v,i)=>{
  total+=v.c*v.p;
  dec+=v.c;
  benef+=v.c*b;
  list.innerHTML+=`
  <div class="card">
  ${v.n} â€“ ${v.c} dÃ©cimos â€“ ${v.p}â‚¬ (${v.f})<br>
  ${v.o}
  <button onclick="delVenta(${i})">âŒ</button>
  </div>`;
 });
 res.innerHTML=`
 ğŸ’° Total recaudado: ${total} â‚¬<br>
 ğŸŸï¸ DÃ©cimos vendidos: ${dec}<br>
 ğŸ¾ Beneficio ARACEA: ${benef} â‚¬
 `;
}

function delVenta(i){
 data.campaigns[currentCamp][currentYear].ventas.splice(i,1);
 save();renderVentas();
}

function closeCampaign(){
 data.campaigns[currentCamp][currentYear].closed=true;
 save();alert("CampaÃ±a cerrada");
}

function backYears(){
 document.getElementById("campaignView").classList.add("hidden");
 document.getElementById("yearView").classList.remove("hidden");
}

function backHome(){
 document.getElementById("yearView").classList.add("hidden");
 document.getElementById("campaignView").classList.add("hidden");
 document.getElementById("historyView").classList.add("hidden");
 document.getElementById("backupView").classList.add("hidden");
 document.getElementById("homeView").classList.remove("hidden");
}

function showGlobalHistory(){
 document.getElementById("homeView").classList.add("hidden");
 document.getElementById("historyView").classList.remove("hidden");
 let h=document.getElementById("historyList");
 h.innerHTML="";
 Object.keys(data.campaigns).forEach(c=>{
  Object.keys(data.campaigns[c]).forEach(y=>{
   let sum=0;
   data.campaigns[c][y].ventas.forEach(v=>sum+=v.c*v.p);
   h.innerHTML+=`<div class="card">${c} ${y} â†’ ${sum} â‚¬</div>`;
  });
 });
}

function showBackup(){
 document.getElementById("homeView").classList.add("hidden");
 document.getElementById("backupView").classList.remove("hidden");
}

function exportBackup(){
 let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="aracea_backup.json";
 a.click();
}

function importBackup(){
 let f=document.getElementById("importFile").files[0];
 if(!f)return;
 let r=new FileReader();
 r.onload=e=>{
  data=JSON.parse(e.target.result);
  save();alert("Copia restaurada");
  backHome();
 };
 r.readAsText(f);
}
</script>
</body>
</html>
